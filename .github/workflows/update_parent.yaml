name: parent-updater

on:
  push:
    branches:
      - release-v0.17.3-lyft.1

jobs:
  update:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3
        with:
          repository: ${{ secrets.PARENT_REPOSITORY }}
          token: ${{ secrets.PARENT_REPO_TOKEN }}

      - name: submodule / init
        run: |
          git submodule update --init --recursive
      - name: submodule / update
        run: |
          git submodule update --recursive --remote
      - name: pull request / create
        id: cpr
        uses: peter-evans/create-pull-request@v3
        with:
          token: ${{ secrets.PARENT_REPO_TOKEN }}
          commit-message: Update Submodule to sha ${{ github.sha }}
          branch-suffix: short-commit-hash
          title: "[AUTOGENERATED] Update Submodule to sha ${{ github.sha }}"
          body: |
            Auto-generated by [create-pull-request][1]

            [1]: https://github.com/peter-evans/create-pull-request
          draft: false
      - name: pull request / merge
        uses: peter-evans/create-or-update-comment@v1
        with:
          token: ${{ secrets.PARENT_REPO_TOKEN }}
          repository: ${{ secrets.PARENT_REPOSITORY }}
          issue-number: ${{ steps.cpr.outputs.pull-request-number }}"
          body: |
            /merge-skip-owners
